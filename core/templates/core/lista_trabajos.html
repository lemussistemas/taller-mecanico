<!-- core/templates/core/lista_trabajos.html -->
{% extends "core/base.html" %}
{% block title %}Lista de Trabajos{% endblock %}
{% block content %}
<h1 class="text-2xl mb-4">Lista de Trabajos</h1>

<table class="min-w-full bg-white shadow rounded">
  <thead>
    <tr>
      <th class="px-4 py-2">ID</th>
      <th class="px-4 py-2">Vehículo</th>
      <th class="px-4 py-2">Técnico</th>
      <th class="px-4 py-2">Tipo</th>
      <th class="px-4 py-2">Ingreso</th>
      <th class="px-4 py-2">Salida</th>
      <th class="px-4 py-2">Ganancia</th>
      <th class="px-4 py-2">Acciones</th>
    </tr>
  </thead>
  <tbody>
  {% for t in trabajos %}
    <tr class="border-t">
      <td class="px-4 py-2">{{ t.id }}</td>
      <td class="px-4 py-2">{{ t.vehiculo }}</td>
      <td class="px-4 py-2">{{ t.tecnico }}</td>
      <td class="px-4 py-2">{{ t.get_tipo_display }}</td>
      <td class="px-4 py-2">{{ t.fecha_ingreso|date:"Y-m-d H:i" }}</td>
      <td class="px-4 py-2">{{ t.fecha_salida|date:"Y-m-d H:i" }}</td>
      <td class="px-4 py-2">{{ t.ganancia }}</td>
      <td class="px-4 py-2 space-x-1">
        <!-- Enlace Editar siempre visible -->
        <a href="{% url 'trabajo_edit' t.pk %}" class="text-blue-600 hover:underline">Editar</a>
        <!-- Enlace Eliminar sólo si tiene permiso -->
        {% if perms.core.delete_trabajo %}
          | <a href="{% url 'trabajo_delete' t.pk %}" class="text-red-600 hover:underline">Eliminar</a>
        {% endif %}
         <!-- Factura para cualquier usuario autenticado -->
  | <a href="{% url 'trabajo_factura' t.pk %}" class="text-indigo-600 hover:underline">Factura</a>
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="8" class="px-4 py-2 text-center">No hay trabajos registrados.</td></tr>
  {% endfor %}
  </tbody>
</table>

{% if is_paginated %}
  <div class="mt-4 flex justify-center space-x-2">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 bg-gray-200 rounded">« Anterior</a>
    {% endif %}
    <span class="px-3 py-1 bg-gray-100 rounded">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 bg-gray-200 rounded">Siguiente »</a>
    {% endif %}
  </div>
{% endif %}



  {% if is_paginated %}
  <div class="mt-6 flex justify-center items-center space-x-2">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}"
         class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition">« Anterior</a>
    {% endif %}
    <span class="px-3 py-1 bg-gray-100 rounded">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}"
         class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition">Siguiente »</a>
    {% endif %}
  </div>
  {% endif %}
{% endblock %}
